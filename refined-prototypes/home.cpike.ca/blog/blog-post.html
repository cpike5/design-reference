<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building a CLI with Go and Cobra - cpike.dev</title>
    <link rel="stylesheet" href="../css/site.css">
    <link rel="stylesheet" href="../css/public-pages.css">
    <link rel="stylesheet" href="../css/blog-post.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <a href="index.html" class="logo-text">cpike.dev</a>
            </div>

            <nav class="nav">
                <div class="nav-group">
                    <div class="nav-label">Public</div>
                    <div class="nav-items">
                        <a href="blog.html" class="nav-item active">Blog</a>
                        <a href="projects.html" class="nav-item">Projects</a>
                        <a href="about.html" class="nav-item">About</a>
                    </div>
                </div>
            </nav>

            <div class="sidebar-footer">
                cpike.dev
            </div>
        </div>

        <!-- Main -->
        <div class="main">
            <!-- Header -->
            <div class="header">
                <a href="blog.html" class="back-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Back to Blog
                </a>
                <div class="header-actions">
                    <button class="share-btn" title="Share">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="18" cy="5" r="3"/>
                            <circle cx="6" cy="12" r="3"/>
                            <circle cx="18" cy="19" r="3"/>
                            <path d="M8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="content">
                <article class="article">
                    <!-- Article Header -->
                    <header class="article-header">
                        <div class="article-meta">
                            <time class="article-date">January 18, 2024</time>
                            <span class="article-reading-time">8 min read</span>
                        </div>
                        <h1 class="article-title">Building a CLI with Go and Cobra</h1>
                        <p class="article-subtitle">
                            A comprehensive guide to building command-line tools in Go using the Cobra library.
                        </p>
                        <div class="article-tags">
                            <a href="#" class="article-tag">Go</a>
                            <a href="#" class="article-tag">Tutorial</a>
                            <a href="#" class="article-tag">CLI</a>
                        </div>
                    </header>

                    <!-- Article Body -->
                    <div class="article-body">
                        <p class="lead">
                            Command-line interfaces remain one of the most powerful ways to interact with software.
                            In this tutorial, we'll build a production-ready CLI application using Go and the Cobra library.
                        </p>

                        <h2>Why Go for CLI Tools?</h2>
                        <p>
                            Go has become the de facto language for building CLI tools, and for good reason.
                            It compiles to a single binary with no runtime dependencies, has excellent cross-compilation
                            support, and the standard library provides everything you need for most CLI operations.
                        </p>
                        <p>
                            Tools like <code>kubectl</code>, <code>docker</code>, <code>gh</code>, and <code>terraform</code>
                            are all built with Go. The ecosystem is mature and battle-tested.
                        </p>

                        <h2>Setting Up the Project</h2>
                        <p>
                            Let's start by creating a new Go module and installing Cobra:
                        </p>

                        <pre><code>mkdir mycli && cd mycli
go mod init github.com/username/mycli
go install github.com/spf13/cobra-cli@latest</code></pre>

                        <p>
                            Cobra CLI provides scaffolding commands that make it easy to add new commands to your application.
                            Initialize the project structure:
                        </p>

                        <pre><code>cobra-cli init
cobra-cli add serve
cobra-cli add config</code></pre>

                        <h2>Understanding the Command Structure</h2>
                        <p>
                            Cobra uses a hierarchical command structure. Each command can have subcommands, flags, and arguments.
                            Here's a typical structure:
                        </p>

                        <pre><code>mycli/
├── cmd/
│   ├── root.go      # Root command
│   ├── serve.go     # Serve subcommand
│   └── config.go    # Config subcommand
├── main.go
└── go.mod</code></pre>

                        <p>
                            The root command is special—it's what runs when users invoke your CLI without any subcommands.
                            It's also where you define global flags that apply to all commands.
                        </p>

                        <h2>Adding Flags and Configuration</h2>
                        <p>
                            Cobra integrates seamlessly with Viper for configuration management. This allows your CLI to read
                            from config files, environment variables, and command-line flags with automatic precedence handling.
                        </p>

                        <pre><code>func init() {
    rootCmd.PersistentFlags().StringVar(&cfgFile, "config", "",
        "config file (default is $HOME/.mycli.yaml)")
    rootCmd.PersistentFlags().BoolVarP(&verbose, "verbose", "v", false,
        "enable verbose output")

    viper.BindPFlag("verbose", rootCmd.PersistentFlags().Lookup("verbose"))
}</code></pre>

                        <blockquote>
                            <p>
                                <strong>Tip:</strong> Use persistent flags for options that should be available to all subcommands,
                                and local flags for command-specific options.
                            </p>
                        </blockquote>

                        <h2>Best Practices</h2>
                        <p>
                            After building several CLI tools, here are some patterns I've found helpful:
                        </p>

                        <ul>
                            <li><strong>Use consistent flag names</strong> across commands. If one command uses <code>--output</code>,
                                they all should.</li>
                            <li><strong>Provide sensible defaults</strong> so users can run commands with minimal configuration.</li>
                            <li><strong>Include examples</strong> in your help text. Users often learn by example.</li>
                            <li><strong>Support both long and short flags</strong> for commonly used options.</li>
                            <li><strong>Return meaningful exit codes</strong> so your CLI works well in scripts.</li>
                        </ul>

                        <h2>Testing Your CLI</h2>
                        <p>
                            Cobra commands are just functions, making them easy to test. You can execute commands programmatically
                            and capture their output:
                        </p>

                        <pre><code>func TestServeCommand(t *testing.T) {
    cmd := NewRootCmd()
    buf := new(bytes.Buffer)
    cmd.SetOut(buf)
    cmd.SetArgs([]string{"serve", "--port", "8080"})

    err := cmd.Execute()
    assert.NoError(t, err)
    assert.Contains(t, buf.String(), "Starting server")
}</code></pre>

                        <h2>Wrapping Up</h2>
                        <p>
                            Building CLI tools with Go and Cobra is a joy. The combination of Go's simplicity,
                            single-binary distribution, and Cobra's well-designed API makes it easy to build
                            professional-grade tools quickly.
                        </p>
                        <p>
                            In a future post, I'll cover more advanced topics like interactive prompts, progress bars,
                            and distributing your CLI via package managers.
                        </p>
                    </div>

                    <!-- Article Footer -->
                    <footer class="article-footer">
                        <div class="author-card">
                            <div class="author-avatar">CP</div>
                            <div class="author-info">
                                <div class="author-name">Chris Pike</div>
                                <div class="author-bio">Software developer writing about .NET, Go, and developer tools.</div>
                            </div>
                        </div>
                    </footer>
                </article>

                <!-- Post Navigation -->
                <nav class="post-nav">
                    <a href="#" class="post-nav-link post-nav-prev">
                        <span class="post-nav-label">Previous</span>
                        <span class="post-nav-title">My 2024 Dev Setup and Tools</span>
                    </a>
                    <a href="#" class="post-nav-link post-nav-next">
                        <span class="post-nav-label">Next</span>
                        <span class="post-nav-title">Deploying Blazor Apps to Azure</span>
                    </a>
                </nav>
            </div>
        </div>
    </div>
    <script src="../js/site.js" type="text/javascript"></script>
</body>
</html>
